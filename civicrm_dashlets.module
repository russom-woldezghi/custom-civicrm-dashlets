<?php

/**
 * @file
 * Add Non-report CiviCRM dashlets 
 * Implements hook_help().
 */
function civicrm_dashlets_help($path = 'admin/help#civicrm_dashlets') {
  switch ($path) {
    case 'admin/help#civicrm_dashlets':
      return t('This module integrates with CiviCRM dashboard to allow custom dashlets.');
  }
}

/**
 * User Permissions
 */
function civicrm_dashlets_permission() {
  return array(
    'administer civicrm_dashlets' => array(
      'title' => t('Administer CiviCRM Dashlets'),
      'description' => t('Perform administration tasks for CiviCRM Dashlets.'),
    ),
  );
}

//link in configure your dashboard

function civicrm_dashlets_civicrm_dashboard($contactID, &$contentPlacement) {
  drupal_add_js(drupal_get_path('module', 'civicrm_dashlets') . '/dashlets.js');
}

//CiviCRM xmlMenu to list CiviCRM Dashlets CiviCRM Page
function civicrm_dashlets_civicrm_xmlMenu( &$files ) {
  // Get xml menu file
   $files[] =
        dirname( __FILE__ ) . DIRECTORY_SEPARATOR .
       'civicrm_dashlets.xml';
}

function civicrm_dashlets_civicrm_config(&$config) {
  $template =& CRM_Core_Smarty::singleton();
 
  $root = dirname(__FILE__) . DIRECTORY_SEPARATOR;
  $template_dir = $root . 'templates';
 
  // Add our template directory to the Smarty templates path
  if (is_array($template->template_dir)) {
    array_unshift($template->template_dir, $template_dir);
  }
  else {
    $template->template_dir = array($template_dir, $template->template_dir);
  }
 
  // Also fix php include path
  $include_path = $root . 'php' . DIRECTORY_SEPARATOR . PATH_SEPARATOR . get_include_path();
  set_include_path($include_path);
}